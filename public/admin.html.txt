<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ç¥ã®éƒ¨å±‹ - ç®¡ç†ç”»é¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #1a1a1a; color: #eee; font-family: sans-serif; padding: 20px; }
        h1 { border-bottom: 1px solid #444; padding-bottom: 10px; font-size: 1.5rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #444; padding: 10px; text-align: left; }
        th { background: #333; }
        .delete-btn {
            background: #c0392b; color: white; border: none; padding: 5px 10px;
            cursor: pointer; border-radius: 4px;
        }
        .delete-btn:hover { background: #e74c3c; }
        .status-sent { color: #2ecc71; } /* æµ·ã¸ï¼ˆé€ä¿¡æ¸ˆã¿ï¼‰ */
        .status-wait { color: #f1c40f; } /* é™¸ã¸ï¼ˆå¾…æ©Ÿä¸­ï¼‰ */
    </style>
</head>
<body>
    <h1>ğŸŒŠ åã‚‚ãªãæµ· - å…¨æ¼‚æµç‰©ãƒªã‚¹ãƒˆ</h1>
    <div id="msg-list">èª­ã¿è¾¼ã¿ä¸­...</div>

    <script>
        // â˜…ã“ã“ãŒåˆè¨€è‘‰ï¼ˆserver.jsã¨åŒã˜ã«ã™ã‚‹ï¼‰
        const SECRET_KEY = "niigata2026"; 

        async function loadMessages() {
            try {
                // åˆè¨€è‘‰ã‚’ã¤ã‘ã¦ã‚µãƒ¼ãƒãƒ¼ã«å•ã„åˆã‚ã›ã‚‹
                const res = await fetch(`/api/admin/all?key=${SECRET_KEY}`);
                
                if (!res.ok) {
                    throw new Error("èªè¨¼ã‚¨ãƒ©ãƒ¼");
                }

                const data = await res.json();
                
                // ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã«ã—ã¦è¡¨ç¤ºã™ã‚‹
                let html = `<table><tr><th>ID</th><th>å†…å®¹</th><th>çŠ¶æ…‹</th><th>æ“ä½œ</th></tr>`;
                data.forEach(msg => {
                    const status = msg.isSent ? '<span class="status-sent">æµ·ã¸</span>' : '<span class="status-wait">é™¸ã¸</span>';
                    html += `
                        <tr>
                            <td style="font-size:0.8rem; color:#888;">${msg._id}</td>
                            <td>${msg.text}</td>
                            <td>${status}</td>
                            <td><button class="delete-btn" onclick="deleteMsg('${msg._id}')">æ²ˆã‚ã‚‹</button></td>
                        </tr>`;
                });
                html += "</table>";
                document.getElementById('msg-list').innerHTML = html;
            } catch (e) {
                document.getElementById('msg-list').innerText = "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ï¼ˆåˆè¨€è‘‰ãŒé•ã†ã‹ã€ã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šãŒã¾ã ã§ã™ï¼‰";
            }
        }

        async function deleteMsg(id) {
            if(!confirm("æœ¬å½“ã«ã“ã®è¨€è‘‰ã‚’æ²ˆã‚ã¾ã™ã‹ï¼Ÿ\nï¼ˆäºŒåº¦ã¨æˆ»ã‚Šã¾ã›ã‚“ï¼‰")) return;
            
            // å‰Šé™¤å‘½ä»¤ã‚’é€ã‚‹
            await fetch('/api/admin/delete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ key: SECRET_KEY, id: id })
            });
            // ç”»é¢ã‚’æ›´æ–°ã—ã¦ãƒªã‚¹ãƒˆã‚’æœ€æ–°ã«ã™ã‚‹
            loadMessages(); 
        }

        // ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸã‚‰èª­ã¿è¾¼ã‚€
        loadMessages();
    </script>
</body>
</html>